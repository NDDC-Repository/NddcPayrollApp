@page "/statutorudetails"
@using NddcPayrollLibrary.Data.EmployeeData;
@using NddcPayrollLibrary.Data.Helper;
@using NddcPayrollLibrary.Data.Reports;
@using NddcPayrollLibrary.Model.Company;
@using NddcPayrollLibrary.Model.Employee;

@inject IEmployeeData empDb;
@inject ICompanyData compDb;
@inject IHelperData helperDb;
@inject IReportsData repDb;


<EditForm Model="StatutoryDetails">
    <div class="row">

        <div class="col-md-6">
            <div class="mb-3">
                <label for="firstNameinput" class="form-label">State Province</label>
                <select @bind="@StatutoryDetails.TaxStateProvince" class="form-select" >
                    <option selected="">Choose...</option>
                    @foreach (var item in PayPoints)
                    {
                        <option value="@item.Code">@item.PayPoint</option>
                    }
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label for="firstNameinput" class="form-label">Tax Status</label>
                <select @bind="@StatutoryDetails.TaxStatus" id="ForminputState" class="form-select" data-choices="" data-choices-sorting="true">
                    <option selected="">Choose...</option>
                    <option>Tax Tables</option>
                    <option>No Tax</option>

                </select>
            </div>
        </div>

    </div>
    <div class="row">

        <div class="col-md-6">
            <div class="mb-3">
                <label for="firstNameinput" class="form-label">Tax Office</label>
                <input type="text" class="form-control" placeholder="Enter First Name" @bind="@StatutoryDetails.TaxOffice">
            </div>
        </div>
        <!--end col-->
        <div class="col-md-6">
            <div class="mb-3">
                <label for="lastNameinput" class="form-label">Tax Number</label>
                <input type="text" class="form-control" placeholder="Enter your lastname" @bind="@StatutoryDetails.TaxNumber">
            </div>
        </div>
        <!--end col-->
        <div class="col-md-6">
            <div class="mb-3">
                <label for="compnayNameinput" class="form-label">Tax Start Date</label>
                <input type="date" class="form-control" @bind="@StatutoryDetails.TaxStartDate">
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">Age (Tax Year)</label>
                <input @bind="@Age" readonly class="form-control">
            </div>
        </div>
        <div class="col-md-12 mt-4"></div>
        <hr />
        <div class="col-md-12 mt-4"></div>
        <div class="col-md-12">
            <div class="mb-3">
                <label for="compnayNameinput" class="form-label">National Housing Fund (NHF) Number</label>
                <input type="text" class="form-control" placeholder="Enter NHF Number" @bind="@StatutoryDetails.NHFNumber">
            </div>
        </div>
        <div class="col-md-12">
            <div class="mb-3">

                <div class="form-check form-switch form-switch-md" dir="ltr">
                    <input type="checkbox" class="form-check-input" @bind="@StatutoryDetails.NHFStatus">
                    <label class="form-check-label" for="customSwitchsizemd">National Housing Fund (NHF) Status</label>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="mb-3">
                <label for="compnayNameinput" class="form-label">National Health Insurance Fund (NHIS) </label>
                <input type="text" class="form-control" placeholder="Enter NHF Number" @bind="@StatutoryDetails.NHIS">
            </div>
        </div>
        <div class="col-md-12">
            <div class="mb-3">

                <div class="form-check form-switch form-switch-md" dir="ltr">
                    <input type="checkbox" class="form-check-input" @bind="@StatutoryDetails.NHISStatus">
                    <label class="form-check-label" for="customSwitchsizemd">National Health Insurance Status (NHIS)</label>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="mb-3">
                <label for="compnayNameinput" class="form-label">Medical AId Health Insurance Name </label>
                <select @bind="@StatutoryDetails.MedicalAidName" class="form-select" data-choices="" data-choices-sorting="true">
                    <option selected="">Choose...</option>

                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">

                <div class="form-check form-switch form-switch-md" dir="ltr">
                    <div class="mb-3">
                        <label for="compnayNameinput" class="form-label">Medical Aid Number</label>
                        <input type="text" class="form-control" placeholder="" @bind="@StatutoryDetails.MedicalAidNumber">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="mb-3">
                <label for="compnayNameinput" class="form-label">Pension Fund Code </label>
                <select class="form-select" @bind="@StatutoryDetails.PensionFundId" >
                    <option selected="">Choose...</option>
                    @foreach (var item in PensionAdmins)
                    {
                        <option value="@item.Id">@item.FullDescription</option>
                    }
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">

                <div class="form-check form-switch form-switch-md" dir="ltr">
                    <div class="mb-3">
                        <label for="compnayNameinput" class="form-label">Pension Fund Number</label>
                        <input type="text" class="form-control" placeholder="" @bind="@StatutoryDetails.PensionFundNumber">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12 mt-4"></div>
        <hr />
        <div class="col-md-12 mt-4"></div>
        <div class="col-md-12">
            <div class="mb-3">

                <div class="form-check form-switch form-switch-md" dir="ltr">
                    <input type="checkbox" class="form-check-input" @bind="@StatutoryDetails.NSITFSTatus">
                    <label class="form-check-label" for="customSwitchsizemd">Employee Compensation Scheme (NSITF) Status</label>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="mb-3">

                <div class="form-check form-switch form-switch-md" dir="ltr">
                    <input type="checkbox" class="form-check-input" @bind="@StatutoryDetails.ITFStatus">
                    <label class="form-check-label" for="customSwitchsizemd">Industrial Training Fund (ITF) Status</label>
                </div>
            </div>
        </div>
        <!--end col-->
        @*<div class="col-lg-12">
        <div class="text-end">
        <button type="submit" class="btn btn-primary">Submit</button>
        </div>
        </div>*@
        <!--end col-->
    </div>
    <!--end row-->
    <div class="d-flex align-items-start gap-3 mt-4 mb-4">
        
        <button type="submit" @onclick="UpdateDetailsAsync" class="btn btn-success btn-label right ms-auto nexttab nexttab">
            <i class="ri-arrow-right-line label-icon align-middle fs-16 ms-2"></i>
            Update
        </button>
        <p>@Message</p>
    </div>


    <!--end row-->
</EditForm>

@code {

    public MyStatutoryDetailsModel StatutoryDetails { get; set; }

    [Parameter]
    public int EmpId { get; set; }

    public List<MyPayPointModel> PayPoints { get; set; }

    public int Age { get; set; }

    public List<MyPensionFundListModel> PensionAdmins { get; set; }

    public string Message { get; set; }



    protected override void OnInitialized()
    {
        StatutoryDetails = empDb.GetStatutoryDetails(EmpId);
        PayPoints = compDb.GetAllPayPoints();

        DateTime dob = helperDb.GetAnyRecord<DateTime, int>("Employees", "DateOfBirth", "Id", EmpId);

        Age = DateTime.Now.Year - dob.Year;

        PensionAdmins = compDb.GetAllPensionAdminsList();
    }

    private async Task UpdateDetailsAsync()
    {
        StatutoryDetails.EmployeeId = EmpId;
        empDb.AddStatutoryDetails(StatutoryDetails);
       

        await(Task.Run(() => repDb.UpdateEmployeesPayrollByEmpIdAsync(EmpId)));

        Message = "Statutory Details Successfully Updated";
    }

}
